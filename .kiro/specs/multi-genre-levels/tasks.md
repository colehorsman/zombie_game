# Implementation Plan

## Multi-Genre Level System

- [x] 1. Create Genre System Foundation
  - [x] 1.1 Create Genre enum and data models in `src/models.py`
    - Define Genre enum (PLATFORMER, SPACE_SHOOTER, MAZE_CHASE, FIGHTING)
    - Define UnlockCondition dataclass with type and value
    - Define ControlScheme dataclass with movement and actions
    - Define GENRE_UNLOCK_CONDITIONS mapping
    - _Requirements: 10.1, 10.2, 10.3, 10.4_
  - [x] 1.2 Create GenreManager class in `src/genre_manager.py`
    - Implement get_available_genres() returning unlocked genres
    - Implement select_genre() to set account preference
    - Implement get_genre_for_account() with Platformer default
    - Implement check_unlock_conditions() for progression
    - _Requirements: 1.1, 1.2, 1.3, 1.4_
  - [x] 1.3 Write property test for genre preference persistence
    - **Property 2: Genre Preference Persistence**
    - Test that save/load preserves genre preference per account
    - **Validates: Requirements 1.4, 9.5**

- [x] 2. Create Abstract GenreController
  - [x] 2.1 Create GenreController abstract base class in `src/genre_controller.py`
    - Define abstract initialize_level() method
    - Define abstract update() method
    - Define abstract handle_input() method
    - Define abstract check_completion() method
    - Define abstract get_player_controls() method
    - _Requirements: 2.1, 3.1, 4.1, 5.1_
  - [x] 2.2 Write property test for genre selection triggers correct template
    - **Property 1: Genre Selection Triggers Correct Template**
    - Test that each genre loads its corresponding layout type
    - **Validates: Requirements 1.3, 2.1, 3.1, 4.1, 5.1**

- [x] 3. Refactor Existing Platformer to GenreController
  - [x] 3.1 Create PlatformerController extending GenreController
    - Extract existing side-scrolling logic from game_engine.py
    - Implement initialize_level() for platform layout
    - Implement update() for platformer physics
    - Implement handle_input() for jump, run, shoot
    - _Requirements: 2.1, 2.2, 2.3, 2.4_
  - [x] 3.2 Create PatrolBehavior for platformer zombies
    - Implement platform patrol movement
    - Implement horizontal chase when player nearby
    - _Requirements: 7.1_

- [x] 4. Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.

- [x] 5. Implement Space Shooter Genre
  - [x] 5.1 Create SpaceShooterController in `src/space_shooter_controller.py`
    - Implement initialize_level() for vertical space layout
    - Position player ship at bottom of screen
    - Spawn zombies at top in formation patterns
    - _Requirements: 3.1, 3.2, 3.3_
  - [x] 5.2 Implement Space Shooter game loop
    - Handle horizontal movement only
    - Fire projectiles upward
    - Move zombies downward
    - Check for bottom collision (damage player)
    - _Requirements: 3.4, 3.6_
  - [x] 5.3 Write property test for Space Shooter player position
    - **Property 4: Space Shooter Player Position**
    - Test player at bottom, projectiles travel upward
    - **Validates: Requirements 3.2, 3.4**
  - [x] 5.4 Create FormationBehavior for space shooter zombies
    - Implement Galaga-style formation patterns
    - Implement downward descent movement
    - _Requirements: 7.2_
  - [x] 5.5 Write property test for Space Shooter zombie behavior
    - **Property 5: Space Shooter Zombie Behavior**
    - Test zombies spawn at top, move down, damage on bottom reach
    - **Validates: Requirements 3.3, 3.6**

- [x] 6. Implement Maze Chase Genre
  - [x] 6.1 Create MazeLayout class in `src/maze_layout.py`
    - Implement procedural maze generation
    - Ensure valid paths from start to all zombie positions
    - Create fallback pre-built maze
    - _Requirements: 4.1_
  - [x] 6.2 Create MazeChaseController in `src/maze_chase_controller.py`
    - Implement initialize_level() for maze layout
    - Render player as Wally sprite
    - Place zombies as ghost-like entities
    - _Requirements: 4.1, 4.2_
  - [x] 6.3 Implement Maze Chase game loop
    - Handle 4-directional movement (no shooting)
    - Eliminate zombies on front collision (chomp)
    - Damage player on rear collision
    - _Requirements: 4.3, 4.6_
  - [x] 6.4 Write property test for Maze Chase collision direction
    - **Property 7: Maze Chase Collision Direction**
    - Test front collision eliminates, rear collision damages
    - **Validates: Requirements 4.3, 4.6**
  - [x] 6.5 Create GhostBehavior for maze zombies
    - Implement A* pathfinding through maze
    - Implement ghost-like chase/scatter behavior
    - _Requirements: 4.4, 7.3_
  - [x] 6.6 Write property test for Maze Chase movement validity
    - **Property 6: Maze Chase Movement Validity**
    - Test zombie movement only along valid maze paths
    - **Validates: Requirements 4.4**

- [x] 7. Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.

- [x] 8. Implement Boss Battle System (Mortal Kombat Style)
  - [x] 8.1 Create CombatState enum and FighterState enum in `src/models.py`
    - Define CombatState (VS_SCREEN, ROUND_START, FIGHTING, ROUND_END, VICTORY, DEFEAT)
    - Define FighterState (IDLE, WALKING, PUNCHING, KICKING, SPECIAL, BLOCKING, HIT, KO)
    - Define Attack dataclass with damage, range, type
    - _Requirements: 5.3, 13.1, 13.2, 13.3, 13.4_
  - [x] 8.2 Create FightingArena class in `src/fighting_arena.py`
    - Implement arena background rendering per boss type
    - Implement health bar rendering for player and boss
    - Implement round timer display (99 seconds)
    - _Requirements: 11.1, 11.2, 11.3_
  - [x] 8.3 Write property test for boss health bar display
    - **Property 14: Boss Health Bar Display**
    - Test health bars accurately reflect current health
    - **Validates: Requirements 11.2**
  - [x] 8.4 Create PlayerFighter class in `src/player_fighter.py`
    - Implement punch() with quick attack, short range
    - Implement kick() with slower attack, longer range
    - Implement special_move() with powerful attack, long cooldown
    - Implement block() with damage reduction
    - Implement take_damage() with block check
    - _Requirements: 13.1, 13.2, 13.3, 13.4, 13.5, 13.6_
  - [x] 8.5 Write property test for attack damage application
    - **Property 16: Attack Damage Application**
    - Test successful attacks reduce target health by damage value
    - **Validates: Requirements 5.4, 5.5**
  - [x] 8.6 Write property test for block damage reduction
    - **Property 17: Block Damage Reduction**
    - Test blocking reduces incoming damage by at least 50%
    - **Validates: Requirements 13.3**
  - [x] 8.7 Create BossFighter class in `src/boss_fighter.py`
    - Implement boss-specific attacks for each boss type
    - Scattered Spider: Web Strike, Credential Theft, Social Engineering
    - Heartbleed: Memory Leak, Data Bleed, Buffer Overflow
    - WannaCry: Encrypt Strike, Ransom Demand, Worm Spread
    - _Requirements: 12.1, 12.2, 12.3, 12.5_
  - [x] 8.8 Implement Boss AI in BossFighter
    - Implement approach behavior when at range
    - Implement attack selection when in range
    - Implement occasional block/dodge
    - Implement aggression scaling with low health
    - _Requirements: 14.1, 14.2, 14.3, 14.4, 14.5, 14.6_
  - [x] 8.9 Write property test for boss AI aggression scaling
    - **Property 18: Boss AI Aggression Scaling**
    - Test aggression increases as boss health decreases
    - **Validates: Requirements 14.4**
  - [x] 8.10 Create BossBattleController in `src/boss_battle_controller.py`
    - Implement start_boss_battle() to transition to arena
    - Implement VS screen display with portraits
    - Implement round timer countdown
    - Implement combat state machine
    - Implement return to level after battle
    - _Requirements: 5.1, 5.2, 11.1, 11.3, 11.4, 5.8_
  - [x] 8.11 Write property test for boss arena transition
    - **Property 13: Boss Arena Transition**
    - Test transition to arena and return to original level
    - **Validates: Requirements 5.1, 5.8, 11.1**
  - [x] 8.12 Write property test for boss timer behavior
    - **Property 15: Boss Timer Behavior**
    - Test timer counts down from 99, zero determines winner by health
    - **Validates: Requirements 11.3, 11.4**
  - [x] 8.13 Implement victory and defeat handling
    - Display VICTORY screen with quarantine animation on boss defeat
    - Display DEFEATED screen with retry option on player defeat
    - Trigger quarantine API call on victory
    - _Requirements: 5.6, 5.7, 11.6_
  - [x] 8.14 Write property test for victory quarantine trigger
    - **Property 19: Victory Quarantine Trigger**
    - Test boss defeat triggers quarantine animation and API call
    - **Validates: Requirements 5.6**
  - [x] 8.15 Write property test for defeat retry option
    - **Property 20: Defeat Retry Option**
    - Test player defeat shows retry option
    - **Validates: Requirements 5.7**
  - [x] 8.16 Integrate boss battle with level completion
    - Trigger boss battle when all zombies eliminated in level
    - Return to lobby after boss battle victory
    - _Requirements: 5.8_

- [x] 9. Implement Cross-Genre Progress Tracking
  - [x] 9.1 Create ProgressTracker class in `src/progress_tracker.py`
    - Track total_zombies_eliminated across all genres
    - Track levels_completed count
    - Track account_completion status
    - Track per-genre statistics
    - _Requirements: 9.1, 9.2, 9.3_
  - [x] 9.2 Write property test for cross-genre progress aggregation
    - **Property 10: Cross-Genre Progress Aggregation**
    - Test elimination in any genre increases total count
    - Test account completion is genre-independent
    - **Validates: Requirements 9.1, 9.2, 9.3**
  - [x] 9.3 Integrate ProgressTracker with SaveManager
    - Add progress field to save schema
    - Update save() to include progress data
    - Update load() to restore progress
    - _Requirements: 9.4, 9.5_
  - [x] 9.4 Write property test for identity metadata preservation
    - **Property 9: Identity Metadata Preservation**
    - Test zombie metadata preserved across genre adaptations
    - **Validates: Requirements 7.5**

- [x] 10. Implement Genre Unlock System
  - [x] 10.1 Add unlock checking to GenreManager
    - Check conditions after each elimination/completion
    - Unlock Space Shooter after 1 level complete
    - Unlock Maze Chase after 50 zombies
    - Unlock Fighting after 3 levels complete
    - _Requirements: 10.1, 10.2, 10.3, 10.4_
  - [x] 10.2 Write property test for genre unlock conditions
    - **Property 11: Genre Unlock Conditions**
    - Test each unlock fires at exact threshold
    - **Validates: Requirements 10.1, 10.2, 10.3, 10.4**
  - [x] 10.3 Add unlock notification UI
    - Display celebratory notification on unlock
    - Show new genre name and preview
    - _Requirements: 10.5_

- [x] 11. Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.

- [x] 12. Implement Genre Selection UI
  - [x] 12.1 Create GenreSelector component in `src/genre_selector.py`
    - Display available genres with preview icons
    - Show locked genres as grayed out
    - Handle selection input
    - _Requirements: 1.1, 1.2_
  - [x] 12.2 Integrate genre selector with lobby door interaction
    - Show genre selector when door selected
    - Load selected genre's controller
    - Remember preference for account
    - _Requirements: 1.3, 1.5_
  - [x] 12.3 Add genre-specific loading screens
    - Create loading screen for each genre
    - Show genre name and controls hint
    - _Requirements: 6.5_

- [x] 13. Implement Difficulty Scaling
  - [x] 13.1 Add difficulty calculation based on zombie count
    - Scale enemy speed with zombie count
    - Scale spawn rate with zombie count
    - Adjust AI aggressiveness
    - _Requirements: 8.4_
  - [x] 13.2 Write property test for difficulty scaling
    - **Property 12: Difficulty Scaling**
    - Test difficulty increases with zombie count
    - **Validates: Requirements 8.4**
  - [x] 13.3 Add account theming
    - Display account name and purpose
    - Apply visual intensity based on account type
    - _Requirements: 8.3_

- [x] 14. Create Genre-Specific Visual Assets
  - [x] 14.1 Create Space Shooter assets
    - AWS-themed spacecraft sprite
    - Starfield background with cloud elements
    - Formation pattern indicators
    - _Requirements: 6.1_
  - [x] 14.2 Create Maze Chase assets
    - Wally AI agent sprite
    - Maze wall tiles with cloud motifs
    - Ghost-style zombie sprites
    - _Requirements: 6.2_
  - [x] 14.3 Create Fighting assets
    - Arena background with CloudWatch theme
    - Health bars with risk score styling
    - Combat effect sprites
    - _Requirements: 6.3_

- [x] 15. Final Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.
