# Implementation Plan

## Story Mode Educational Enhancements

- [x] 1. Create Dialogue System Foundation
  - [x] 1.1 Create DialogueMessage and DialogueSequence data classes in `src/models.py`
    - Define DialogueMessage with text, speaker, highlight_words fields
    - Define DialogueSequence with messages list, current_page, trigger_type
    - Add next_page() and is_complete() methods
    - _Requirements: 1.4_
  - [x] 1.2 Write property test for DialogueSequence page navigation
    - **Property 1: Dialogue Pause Behavior**
    - Test that next_page advances correctly and is_complete returns true on final page
    - **Validates: Requirements 1.3, 1.5**
  - [x] 1.3 Create DialogueRenderer class in `src/dialogue_renderer.py`
    - Implement render_bubble() with 8-bit comic style and pointed tail
    - Implement render_page_indicator() for multi-page dialogues
    - Implement calculate_bubble_position() to avoid screen edges
    - _Requirements: 1.2, 1.4_

- [x] 2. Implement Educational Progress Tracking
  - [x] 2.1 Create EducationalProgress data class in `src/models.py`
    - Define completed_triggers set, zombies_eliminated count
    - Define first_role_seen, first_user_seen flags
    - Implement has_seen(), to_dict(), from_dict() methods
    - _Requirements: 4.1, 4.5_
  - [x] 2.2 Write property test for educational progress round-trip
    - **Property 4: Educational Progress Round-Trip**
    - Test that to_dict() then from_dict() preserves all progress data
    - **Validates: Requirements 4.2, 4.3**
  - [x] 2.3 Integrate EducationalProgress with SaveManager
    - Add educational_progress field to save schema
    - Update save() to include educational progress
    - Update load() to restore educational progress
    - _Requirements: 4.2, 4.3_
  - [x] 2.4 Write property test for progress tracking independence
    - **Property 5: Progress Tracking Independence**
    - Test that completing one trigger doesn't affect others
    - **Validates: Requirements 4.1, 4.5**

- [x] 3. Create Education Manager
  - [x] 3.1 Create EducationManager class in `src/education_manager.py`
    - Implement check_trigger() to evaluate trigger conditions
    - Implement mark_completed() to record viewed education
    - Implement reset_progress() for tutorial replay option
    - _Requirements: 4.1, 4.4_
  - [x] 3.2 Define TriggerType enum and EDUCATION_CONTENT templates
    - Create TriggerType enum with all trigger types
    - Define dialogue content templates with placeholders for zombie data
    - Include first_zombie_kill, first_role, first_user, milestones
    - _Requirements: 2.2, 2.4, 3.4, 3.5, 5.1, 5.2, 5.3_
  - [x] 3.3 Write property test for first kill education trigger
    - **Property 2: First Kill Education Trigger**
    - Test that first elimination triggers education with zombie name/type
    - **Validates: Requirements 2.1, 2.3, 2.5**

- [x] 4. Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.

- [x] 5. Integrate Dialogue System with Game Engine
  - [x] 5.1 Add dialogue state to GameState in `src/models.py`
    - Add active_dialogue field for current DialogueSequence
    - Add is_dialogue_active property
    - _Requirements: 1.3_
  - [x] 5.2 Update game loop in `src/game_engine.py` to handle dialogue
    - Pause game updates when dialogue is active
    - Handle action button to advance/dismiss dialogue
    - Resume gameplay when dialogue dismissed
    - _Requirements: 1.3, 1.5_
  - [x] 5.3 Add dialogue rendering to `src/renderer.py`
    - Call DialogueRenderer when dialogue is active
    - Render dialogue on top of game content
    - _Requirements: 1.2_

- [x] 6. Implement First Zombie Kill Education
  - [x] 6.1 Add first kill trigger to zombie elimination handler
    - Check if in Story Mode and first kill
    - Create dialogue sequence with zombie name and type
    - Display quarantine explanation
    - _Requirements: 2.1, 2.2, 2.3, 2.4_
  - [x] 6.2 Write property test for zombie info panel completeness
    - **Property 3: Zombie Info Panel Completeness**
    - Test that info panel shows name, type, and days since login
    - **Validates: Requirements 3.1, 3.2, 3.3**

- [x] 7. Implement Zombie Metadata Display
  - [x] 7.1 Create zombie info panel component
    - Display identity name prominently
    - Show identity type (User or Role) with icon
    - Show days since last login
    - _Requirements: 3.1, 3.2, 3.3_
  - [x] 7.2 Add type-specific explanations
    - Show Role explanation on first Role encounter
    - Show User explanation on first User encounter
    - _Requirements: 3.4, 3.5, 5.2, 5.3_
  - [x] 7.3 Write property test for type-specific education
    - **Property 7: Type-Specific Education**
    - Test that first Role triggers service account explanation
    - Test that first User triggers human identity explanation
    - **Validates: Requirements 5.2, 5.3**

- [x] 8. Implement Milestone Tips
  - [x] 8.1 Add milestone tracking to EducationManager
    - Track zombie elimination count
    - Trigger tip at 5 eliminations
    - _Requirements: 5.1_
  - [x] 8.2 Write property test for milestone trigger accuracy
    - **Property 6: Milestone Trigger Accuracy**
    - Test that 5 eliminations triggers audit tip exactly once
    - **Validates: Requirements 5.1**
  - [x] 8.3 Add level completion summary
    - Display summary dialogue on level complete
    - List security concepts learned
    - _Requirements: 5.4_

- [x] 9. Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.

- [ ] 10. Implement AWS Permission Display
  - [ ] 10.1 Create AWSIAMClient class in `src/aws_iam_client.py`
    - Implement srn_to_arn() static method for conversion
    - Implement get_user_policies() for User identities
    - Implement get_role_policies() for Role identities
    - Add caching to reduce API calls
    - _Requirements: 6.1, 6.2, 6.6, 6.7_
  - [ ] 10.2 Write property test for SRN to ARN conversion
    - **Property 8: SRN to ARN Conversion**
    - Test that conversion preserves account, type, and name
    - **Validates: Requirements 6.1**
  - [ ] 10.3 Create PermissionSummary data class
    - Define fields for attached_policies, inline_policies, high_risk_policies
    - Add trust_policy field for Roles
    - Add fetch_error field for graceful degradation
    - _Requirements: 6.3, 6.5_
  - [ ] 10.4 Write property test for AWS permission retrieval
    - **Property 9: AWS Permission Retrieval**
    - Test successful retrieval returns PermissionSummary
    - Test failure returns basic info gracefully
    - **Validates: Requirements 6.2, 6.3, 6.5**
  - [ ] 10.5 Implement high-risk policy detection
    - Define HIGH_RISK_POLICIES list (AdministratorAccess, IAMFullAccess, etc.)
    - Implement is_high_risk() method
    - Highlight high-risk policies in display
    - _Requirements: 6.4_
  - [ ] 10.6 Write property test for high-risk policy detection
    - **Property 10: High-Risk Policy Detection**
    - Test that AdministratorAccess and IAMFullAccess are flagged
    - **Validates: Requirements 6.4**

- [ ] 11. Integrate Permission Display with Dialogue
  - [ ] 11.1 Add permission fetch to zombie elimination flow
    - Fetch permissions asynchronously after elimination
    - Cache results for subsequent displays
    - Timeout after 2 seconds
    - _Requirements: 6.2_
  - [ ] 11.2 Add permission summary to zombie info dialogue
    - Display simplified permission list
    - Highlight high-risk permissions in red
    - Show "Permissions unavailable" on fetch failure
    - _Requirements: 6.3, 6.4, 6.5_

- [ ] 12. Add Tutorial Reset Option
  - [ ] 12.1 Add reset option to settings/pause menu
    - Add "Reset Tutorials" button
    - Confirm before resetting
    - Call EducationManager.reset_progress()
    - _Requirements: 4.4_

- [ ] 13. Final Checkpoint - Ensure all tests pass
  - Ensure all tests pass, ask the user if questions arise.
